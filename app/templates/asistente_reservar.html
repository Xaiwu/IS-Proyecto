<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Reservar/Modificar Cita - Asistente</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>

<body>
    <header>
        <h1>Reservar/Modificar Cita</h1>
        <nav>
            <a href="{{ url_for('main.index') }}">Inicio</a>
            <a href="{{ url_for('main.servicios') }}">Servicios</a>
        </nav>
    </header>
    <section>
        <h2>Elige una Fecha y Hora</h2>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <ul>
            {% for message in messages %}
            <li>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}
        <form method="POST" action="{{ url_for('main.asistente_reservar') }}">
            {{ form.hidden_tag() }}
            <label for="fecha">Fecha:</label>
            {{ form.fecha }}
            <label for="hora">Hora:</label>
            {{ form.hora }}
            <label for="especialista">Especialista:</label>
            {{ form.especialista }}
            <label for="paciente">Paciente:</label>
            {{ form.paciente }}
            {{ form.submit }}
        </form>
        <h2>Pacientes</h2>
        <ul>
            {% for paciente in pacientes %}
            <li>{{ paciente[1] }} - {{ paciente[2] }} - {{ paciente[3] }}</li>
            {% endfor %}
        </ul>
    </section>
    <script>
        $(function () {
            // Inicializar el selector de fecha con jQuery UI Datepicker
            $("#fecha").datepicker({
                dateFormat: "yy-mm-dd",
                onSelect: function (dateText) {
                    // Solicitar las horas disponibles al servidor
                    $.ajax({
                        url: "{{ url_for('main.obtener_horas_disponibles') }}",
                        method: "GET",
                        data: { fecha: dateText, especialista_id: $("#especialista").val() },
                        success: function (data) {
                            var horaSelect = $("#hora");
                            horaSelect.empty();
                            // Agregar las opciones de hora disponibles al campo de selecci√≥n
                            $.each(data.horas, function (index, hora) {
                                horaSelect.append($("<option></option>").attr("value", hora).text(hora));
                            });
                        }
                    });
                }
            });
        });
    </script>
</body>

</html>